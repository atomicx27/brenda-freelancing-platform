ANI - Brenda Freelancing Platform: Complete Project Dossier

Date: 2025-10-30

Overview
- Brenda is a full-stack freelancing platform ("The World's Work Marketplace") implemented as a monorepo with a React/Vite frontend and a Node.js/Express/TypeScript backend using Prisma ORM with a PostgreSQL database (Supabase).
- This dossier documents: architecture, tech stack, environment, database schema (overview), all API endpoints, automation features, email integration, frontend routes/features, tooling, scripts, and known issues.

Repository Structure (top-level)
- brenda/                      React + Vite frontend application
- brenda-backend/              Node.js + Express + TypeScript backend API
- docs/                        Detailed guides and design documents
- README.md                    High-level overview
- Additional project docs: ADMIN_*, ADVANCED_FEATURES_*, COMMUNITY_FEATURES_*, WORKFLOW_AUTOMATION_*, etc.

Tech Stack
- Frontend: React 18, Vite, React Router v6, Tailwind CSS, react-icons, react-loader-spinner, framer-motion
- Backend: Node.js 18+, Express 5, TypeScript 5.9, Prisma 6, express-validator, multer, helmet, cors, morgan, express-rate-limit
- Database: PostgreSQL (Supabase) via Prisma
- Authentication: JWT (access + refresh)
- Email: Resend (transactional and campaign support via service abstraction)
- Storage/Static: Local uploads (served under /uploads) for avatars and assets

Environment & Configuration
- Env file path: brenda-backend/.env (do not commit secrets). Example template: brenda-backend/env.example
- Key variables (names only; do not store values in VCS):
  - DATABASE_URL                 PostgreSQL connection string (Supabase). Use sslmode=require; pgbouncer=true; connection_limit=1 when using Pooler.
  - SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY
  - JWT_SECRET, JWT_REFRESH_SECRET, JWT_EXPIRE, JWT_REFRESH_EXPIRE
  - PORT (default 5000), NODE_ENV (development/production)
  - RESEND_API_KEY, RESEND_FROM
  - Optional: FRONTEND_URL (comma-separated origins for CORS)
- CORS: Allowed origins = defaults [http://localhost:3000, 3001, 5173] plus FRONTEND_URL entries.
- Rate limiting: Generous in development; dedicated limiters for /api/auth and /api/messages.
- Health: GET /health returns server status.

Backend Architecture
- Entry: brenda-backend/src/index.ts
  - Middleware: helmet, cors, rate-limiters, morgan, JSON/urlencoded parsers
  - Static: app.use('/uploads', express.static('uploads'))
  - Routes mounted:
    - /api/auth         -> routes/auth
    - /api/users        -> routes/users
    - /api/upload       -> routes/upload
    - /api/portfolio    -> routes/portfolio
    - /api/company      -> routes/company
    - /api/jobs         -> routes/jobs
    - /api/proposals    -> routes/proposals
    - /api/messages     -> routes/messages
    - /api/reviews      -> routes/reviews
    - /api/analytics    -> routes/analytics
    - /api/admin        -> routes/admin
    - /api/search       -> routes/search
    - /api/community    -> routes/community
    - /api/automation   -> routes/automation
    - /api/email        -> routes/email
  - Error handling: 404 notFound middleware + centralized errorHandler

Database Schema (Prisma) — Highlights
- Key domain models (see brenda-backend/prisma/schema.prisma for full definitions):
  - User, UserProfile, CompanyProfile
  - Job, Proposal, Review, Message
  - PortfolioItem (+ PortfolioView, PortfolioLike)
  - Community: ForumCategory, ForumPost, ForumComment, Group, Events (and related models)
  - Automation: AutomationRule, AutomationLog
  - Contracts/Invoices: SmartContract, ContractTemplate, Invoice
  - Email: EmailCampaign, EmailLog
  - Lead scoring and workflows: LeadScore, JobTemplate, FollowUpRule, Reminder, StatusUpdateRule
- Arrays: skills, languages, tags, technologies, etc. are modeled as String[] for efficient filtering (hasSome).

Automation Features (Implemented)
- Rule engine: AutomationRule with triggers, conditions (JSON), and actions (JSON), tracking run metrics and logs (AutomationLog).
- Smart contracts: generation and management (SmartContract, ContractTemplate), linking to jobs and invoices.
- Invoicing: line items, taxes, status transitions, recurring support fields.
- Email marketing: EmailCampaign with recipients/filters/scheduling; EmailLog for events and analytics.
- Lead scoring: LeadScore with factors and updates.
- Follow-ups: FollowUpRule for automated delayed actions.
- Reminders: Reminder with recurrence and priorities.
- Status updates: StatusUpdateRule for programmatic state transitions across entities.
- Email action: SEND_EMAIL wired through Resend via a service abstraction.

Email Integration (Resend)
- Service: brenda-backend/src/services/emailService.ts
  - Lazy client init; validates RESEND_API_KEY and RESEND_FROM
  - sendEmail({ to, subject, html, from? }) returns provider response; logs/throws on error
- Authenticated test endpoint: POST /api/email/send
  - Body: { to, subject, html } — Auth required
  - Useful for verifying SMTP/provider connectivity

Advanced Search & Filters
- Endpoints:
  - GET /api/search/jobs               Advanced job search with filters and suggestions
  - GET /api/search/freelancers        Advanced freelancer search
  - GET /api/search/filters            Returns categories, popular skills, locations, languages, option lists
  - POST /api/search/preferences       Save search preferences (auth)
  - GET /api/search/preferences        Get saved preferences (auth)
- Skills filter behavior:
  - Backend expects skills[] (repeated query keys) or a properly parsed array; uses Prisma hasSome for String[]
  - Known mismatch: sending skills as a single comma-separated string will not match (must be skills=React&skills=Node.js)

All API Endpoints (by module)
- Health
  - GET /health                                         Server status

- Auth (/api/auth)
  - POST /register                                      Register
  - POST /login                                         Login
  - GET  /me                                            Get current user (auth)
  - POST /logout                                        Logout (auth)

- Users (/api/users) [auth]
  - GET  /profile                                       Get profile (includes UserProfile)
  - PUT  /profile                                       Update profile

- Upload (/api/upload) [auth]
  - POST /avatar                                        Upload avatar (multipart field: file)
  - DELETE /avatar                                      Remove avatar
  - GET  /:filename                                     Serve uploaded file (public)

- Portfolio (/api/portfolio)
  - GET  /categories                                    Public categories and counts
  - GET  /public/user/:userId                           Public portfolio for user
  - GET  /public/item/:id                               Public portfolio item
  - GET  /browse                                        Public browse
  - GET  /featured                                      Featured items
  - GET  /search                                        Search public portfolio
  - POST /:id/view                                      Track view (optional auth)
  - [auth]
    - GET  /                                            Get authenticated user's portfolio
    - GET  /:id                                         Get item by id
    - POST /                                            Create item
    - PUT  /:id                                         Update item
    - DELETE /:id                                       Delete item
    - POST /:id/like                                    Toggle like
    - GET  /stats/overview                              Portfolio stats
    - GET  /:id/stats                                   Item stats
    - POST /bulk/update                                 Bulk update
    - POST /bulk/reorder                                Reorder items

- Company (/api/company)
  - GET  /public                                        Public company profiles
  - GET  /public/:id                                    Company profile by id
  - GET  /industries                                    Industries
  - [auth]
    - GET  /profile                                     Get own company profile
    - PUT  /profile                                     Update company profile
    - GET  /stats                                       Company stats

- Jobs (/api/jobs)
  - GET  /                                              All jobs (public)
  - GET  /todays                                        Today's jobs
  - GET  /categories                                    Job categories
  - GET  /popular-skills                                Popular skills across jobs
  - GET  /:id                                           Job by id
  - [auth]
    - GET  /my/jobs                                     Jobs for current user
    - POST /                                            Create job
    - PUT  /:id                                         Update job
    - DELETE /:id                                       Delete job

- Proposals (/api/proposals) [auth]
  - POST /                                              Create proposal
  - GET  /my-proposals                                  My proposals
  - GET  /stats                                         Proposal stats
  - GET  /:id                                           Proposal by id
  - PUT  /:id                                           Update proposal
  - DELETE /:id                                         Delete proposal
  - GET  /job/:jobId                                    Proposals by job
  - PUT  /:id/status                                    Update proposal status

- Messages (/api/messages) [auth]
  - POST /send                                          Send message
  - GET  /conversation/:userId                          Conversation with user
  - GET  /conversations                                 My conversations
  - PATCH /mark-read                                    Mark as read
  - GET  /search                                        Search messages
  - GET  /unread-count                                  Unread count
  - DELETE /:messageId                                  Delete message

- Reviews (/api/reviews)
  - GET  /recent                                        Recent reviews
  - GET  /user/:userId                                  Reviews for user
  - [auth]
    - POST /                                            Create review
    - GET  /my-reviews                                  My authored reviews
    - PUT  /:reviewId                                   Update review
    - DELETE /:reviewId                                 Delete review
    - POST /:reviewId/report                            Report review

- Analytics (/api/analytics) [auth]
  - GET  /freelancer                                    Freelancer analytics
  - GET  /client                                        Client analytics
  - GET  /admin                                         Admin analytics
  - GET  /health                                        Platform health

- Admin (/api/admin) [auth + admin]
  - GET  /dashboard                                     Dashboard metrics
  - GET  /users                                         List users
  - GET  /users/:userId                                 User details
  - PATCH /users/:userId/status                          Update user status
  - GET  /moderation/:type                              Moderation queue
  - PATCH /moderation/:contentId                        Moderate content
  - GET  /system/health                                 System health
  - GET  /system/logs                                   System logs
  - POST /backup/create                                 Create backup

- Search (/api/search)
  - GET  /jobs                                          Advanced job search
  - GET  /freelancers                                   Advanced freelancer search
  - GET  /filters                                       Filters/options (categories, skills, locations, languages)
  - [auth]
    - POST /preferences                                 Save search preferences
    - GET  /preferences                                  Get saved preferences

- Community (/api/community)
  - GET  /forum/categories                              Forum categories
  - GET  /forum/posts                                   Forum posts
  - GET  /forum/posts/:postId                           Forum post by id
  - GET  /groups                                        Public groups
  - GET  /mentorships                                   Mentorships
  - GET  /knowledge/articles                            Knowledge articles
  - GET  /knowledge/faqs                                FAQs
  - GET  /events                                        Events
  - [auth]
    - POST /forum/posts                                 Create post
    - POST /forum/posts/:postId/comments                Comment on post
    - POST /groups                                      Create user group
    - POST /groups/:groupId/join                        Join group
    - POST /mentorships                                 Create mentorship request
    - POST /events/:eventId/join                        Join event
    - POST /social/like                                 Like content
    - GET  /social/connections                          Get connections
    - POST /social/connect                              Connect with user

- Automation (/api/automation) [auth]
  - GET  /rules                                         List automation rules
  - POST /rules                                         Create automation rule
  - POST /rules/:ruleId/execute                         Execute rule
  - GET  /contracts                                     List smart contracts
  - POST /contracts/generate                            Generate smart contract
  - GET  /invoices                                      List invoices
  - POST /invoices/generate                             Generate invoice
  - GET  /email-campaigns                               List email campaigns
  - POST /email-campaigns                               Create email campaign
  - GET  /lead-scores                                   List lead scores
  - POST /lead-scores/calculate                         Calculate lead score
  - GET  /follow-up-rules                               List follow-up rules
  - POST /follow-up-rules                               Create follow-up rule
  - GET  /reminders                                     List reminders
  - POST /reminders                                     Create reminder
  - GET  /status-update-rules                           List status update rules
  - POST /status-update-rules                           Create status update rule

- Email (/api/email) [auth]
  - POST /send                                          Send a test/transactional email through Resend

Frontend Architecture & Routes
- Entry: brenda/src/main.jsx, brenda/src/App.jsx
- Global Providers: AuthProvider, LanguageProvider
- Layout: Navbar persistent; route-level loading indicator (RouteLoading)
- Routes (selected from App.jsx):
  - /                                 Home
  - /about                            About
  - /contact                          Contact
  - /reviews                          Reviews
  - /success-stories                  SuccessStories
  - /talent-marketplace               TalentMarketplace
  - /how-to-find-work                 HowToFindWork
  - /how-to-hire                      HowToHire
  - /account-security/login           Login
  - /account-security/signup          Signup
  - /admin                            AdminAccess
  - /admin/login                      AdminLogin
  - /search                           AdvancedSearchPage (uses AdvancedSearch component)
  - /community                        Community
  - /automation                       AutomationDashboard
  - /automation/contracts/new         SmartContractGenerator page
  - /profile                          Profile
  - /portfolio                        Portfolio
  - /company                          CompanyProfile
  - Jobs:
    - /jobs/all-jobs                  AllJobs
    - /jobs/todays-jobs               TodaysJobs
    - /jobs/create                    CreateJob
    - /jobs/edit/:id                  EditJob
    - /jobs/my-jobs                   MyJobs
    - /jobs/:id                       JobDetails
  - Proposals:
    - /proposals                      MyProposals
  - Messages:
    - /messages                       Chat
    - /messages/:userId               Chat (user conversation)
  - Reviews:
    - /reviews/user/:userId           UserReviews
    - /reviews/my-reviews             MyReviews
  - Dashboards:
    - /dashboard                      Dashboard
    - /dashboard/freelancer           FreelancerDashboard
    - /dashboard/client               ClientDashboard
    - /dashboard/admin                AdminDashboard
  - Enterprise & Hire:
    - /enterprise                     Enterprise
    - /hire                           Hire
  - Categories:
    - /cat/admin-customer-support, /cat/design-creative, /cat/dev-it, /cat/engineering-architecture, /cat/finance-accounting, /cat/hr-training, /cat/legal, /cat/sales-marketing, /cat/writing-translation
  - Services:
    - /services, /services/articles-blog-posts, /services/logo-design, /services/seo, /services/social-media-management, /services/video-editing, /services/wordpress
  - Staffing:
    - /staffing, /staffing/design-creative, /staffing/development, /staffing/marketing
  - 404:
    - *                                 NotFound

Frontend Notable Features
- AdvancedSearch component: complex filters (category, subcategory, skills[], location, remote, budget, duration, experience; freelancer: hourly rate, availability, languages[]); saves searches; fetches dynamic filter options via /api/search/filters.
- AutomationDashboard: overview of automation data, resilient loading with Promise.allSettled; includes test email send UI calling /api/email/send.
- SmartContractGenerator: full form to generate contracts calling /api/automation/contracts/generate.
- API Service Layer: brenda/src/services/api.js holds methods for all API groups including advanced search, portfolio, jobs, proposals, automation, email, admin, analytics.

Security & Auth
- JWT-based auth; protected routes use authenticate middleware; some admin routes require requireAdmin.
- Rate limits: dedicated for /api/auth (login/register) and /api/messages; generous in development.
- CORS configured for local dev + optional FRONTEND_URL domains.

Tooling & Scripts
- Backend (brenda-backend/package.json):
  - build: tsc
  - start: node dist/index.js
  - dev: nodemon src/index.ts
  - db:generate, db:push, db:migrate, db:studio
  - db:seed (ts-node prisma/seed.ts), admin:seed (seed initial admin user and related data)
- Frontend (brenda/package.json):
  - dev: vite
  - build: vite build
  - preview: vite preview
  - lint: eslint on src

Seed/Test Utilities
- Scripts under brenda-backend/scripts/: clearRateLimit.js, generateSecrets.js, seedJobs.js, verifyJobs.js, testMessages.js (utility/testing helpers)
- Test drivers at repo root of backend: test-server.js, test-public-portfolio.js, test-all-portfolio-endpoints.js, test-automation-apis.js

Known Issues & Notes
- Database connectivity: Prisma P1001 (cannot reach Supabase) has occurred; see docs/SUPABASE_SETUP.md and docs/BACKEND_SETUP.md for troubleshooting (ensure project not paused; use pooler; correct ssl flags; allow outbound network; verify credentials).
- Skills filter caveat: Frontend must send skills as repeated query params (skills=React&skills=Node.js) or the backend must parse comma-separated values. Otherwise, hasSome(['React,Node.js']) will not match records.
- Email: Ensure RESEND_API_KEY and RESEND_FROM are configured; test via POST /api/email/send (auth required).

Quality Gates
- TypeScript compiles (tsconfig present); linting configured for frontend.
- Run prisma generate before running backend; run db:push/db:migrate only when DB reachable.

How to Run (local, brief)
- Backend:
  1) Set brenda-backend/.env (see env.example)
  2) Install deps: npm install
  3) Generate Prisma client: npm run db:generate
  4) Start dev server: npm run dev (default http://localhost:5000)
- Frontend:
  1) cd brenda; npm install
  2) npm run dev (default http://localhost:5173)

References
- Backend entry: brenda-backend/src/index.ts
- Routes: brenda-backend/src/routes/*.ts
- Controllers: brenda-backend/src/controllers/*
- Prisma schema: brenda-backend/prisma/schema.prisma
- Frontend routes: brenda/src/App.jsx
- API client: brenda/src/services/api.js
- Docs: docs/* (setup, automation, community, admin, error handling, competitive analysis)

End of ANI
